<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>OpenLayers Map Screenshot</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="bootstrap/bootstrap.min.css">

    <link href="bootstrap/prism.css" rel="stylesheet" />

    <style>
        #map {
            /* position: fixed; */
            /* top: 90px;
            left: 0px; */
            width: 100%;
            height: 400px;
        }
    </style>
</head>

<body>

    <div class='container text-center'>
        <h1 class="h2 py-3">ol-map-screenshot library demo</h1>
        <p>It allows you to export an OpenLayers map as a PNG and JPG image and PDF document.</p>
        <div class='row'>
            <div class='col-4'></div>
            <div class='col-4'>
                <div class="btn-group mr-2">
                    <button id="export-jpeg-button" type="button" class="btn btn-sm btn-outline-secondary"><i class="fa fa-download"></i> JPEG</button>
                    <button id="export-png-button" type="button" class="btn btn-sm btn-outline-secondary"><i class="fa fa-download"></i> PNG</button>
                    <button id="export-pdf-button" type="button" class="btn btn-sm btn-outline-secondary"><i class="fa fa-file-pdf-o"></i> PDF</button>
                </div>
            </div>
            <div class='col-4'></div>
        </div>

        <div class='row'>
            <div class='col-12'>
                <div id='map'></div>

            </div>
        </div>

        <div class="row-fluid">

            <pre><legend>index.js</legend><code id="example-js-source" class="language-js">
import 'ol/ol.css';
import Map from 'ol/Map';
import View from 'ol/View';
import TileLayer from 'ol/layer/Tile';
import OSM from 'ol/source/OSM';
import olMapScreenshot from 'ol-map-screenshot';
                    
const map = new Map({
    layers: [
        new TileLayer({
            source: new OSM()
        })
    ],
    target: 'map',
    view: new View({
        center: [-531626.1241455, 4563250.0861921],
        zoom: 14
    })
});
                    
const mapScreenshotParam = {
    dim: [190, 160],
    showDisplayScale: true
};
                    
document.getElementById('export-jpeg-button').onclick = async() => {
    doDonwload('map-screenshot.jpg');
};
                    
document.getElementById('export-png-button').onclick = async() => {
    mapScreenshotParam.format = "png";
    doDonwload('map-screenshot.png');
};
                    
document.getElementById('export-pdf-button').onclick = async() => {
    mapScreenshotParam.format = "jpeg";
    const response = await doScreenshot();
    createPDFDocument(response);
};
                    
function createPDFDocument(data) {
    const pdf = new jsPDF('p', 'mm', 'a4');
    pdf.setFont("times");
    pdf.setFontSize(16);
    pdf.setFontStyle("bold");
    const title = "ol-map-screenshop example!";
    const pageWidth = pdf.internal.pageSize.width;
    const titleLength = (pdf.getTextDimensions(title).w / (72 / 25.6)) + 2;
    pdf.text((pageWidth / 2) - titleLength, 20, title);
    pdf.setFontSize(10);
    pdf.setFontStyle("italic");
    pdf.text(10, 28, "Location: Córdoba, Andalucia, España");
    pdf.addImage(data.img, 'JPEG', 10, 30, data.w, data.h);
    pdf.save('map-screenshot.pdf');
}
                    
async function doDonwload(fileName) {
    const response = await doScreenshot();
    const link = document.getElementById('image-download');
    link.download = fileName;
    link.href = response.img;
    link.click();
}
                    
async function doScreenshot() {
    const mapCurrentSize = map.getSize();
    const response = await olMapScreenshot.getScreenshot(map, mapScreenshotParam);
    map.setSize(mapCurrentSize);
    return response;
}
</code></pre></div>

    </div>

    <a id="image-download"></a>

    <script src="bootstrap/jquery-3.4.1.slim.min.js"></script>
    <script src="bootstrap/popper.min.js"></script>
    <script src="bootstrap/bootstrap.min.js"></script>
    <script src="bootstrap/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>

    <script src="./index.js"></script>
</body>

</html>